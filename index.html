
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Shiny happy people coding</title>
  <meta name="author" content="Cyril Mougel">

  
  <meta name="description" content="Since several month, I use only Rabl
to do all my API. To me this gems is really awesome. Before using it, I
try doing all of my API with the # &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog-en.shingara.fr//index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Shiny happy people coding" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-15589471-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Shiny happy people coding</a></h1>
  
    <h2>Coding with smile</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog-en.shingara.fr/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/test-your-rabl-view.html">Test Your Rabl&#8217;s View</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-03T09:40:00+02:00" pubdate data-updated="true">Jul 3<span>rd</span>, 2012</time>
        
         | <a href="/test-your-rabl-view.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Since several month, I use only <a href="https://github.com/nesquena/rabl">Rabl</a>
to do all my API. To me this gems is really awesome. Before using it, I
try doing all of my API with the <code>#to_json</code> method. But it was a
nightmare. If you already try to do that, you understand what I mean.
The most bad case is when you want represent your object in different
way depending of where is represent.</p>

<h1>Rabl simply clean</h1>

<p>To manage your JSON and XML view, the most common gem is <code>JBuilder</code> and
<code>XmlBuilder</code>, both are created by DHH. To me it&#8217;s not a good DSL and can
be a little too verbose. Rabl has a clean a simplest DSL and you just
need one view to generate XML and JSON. You can even generate some other
output with Rabl.</p>

<p>A little example of Rabl&#8217;s view :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">object</span> <span class="vi">@post</span>
</span><span class='line'><span class="n">attribute</span> <span class="ss">:content</span>
</span><span class='line'><span class="n">child</span><span class="p">(</span><span class="ss">:author</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">attribute</span> <span class="ss">:firstname</span><span class="p">,</span> <span class="ss">:lastname</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Test your Rabl&#8217;s view</h1>

<p>To test the output of this view, you have multiple choice. You can
generate this view in an integration test and test this output. You can
do it in your controller test. Or the best, test only your output on
your view test. With this last choice, you can define what you really
put on your view and test only your rabl representation. In this case
you can have a flexible and fast test.</p>

<p>Since Rabl 0.6.0, a new method help to generate your view directly. It&#8217;s
with this method you can simply test our view.</p>

<p>An example of how we can test our view (
<code>spec/views/posts/show_rabl_spec.rb</code>) :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">describe</span> <span class="s2">&quot;blogs/show.rabl&quot;</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">let</span><span class="p">(</span><span class="ss">:auhor</span><span class="p">)</span> <span class="p">{</span> <span class="no">Author</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:firstname</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cyril&#39;</span><span class="p">,</span> <span class="ss">:lastname</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mougel&#39;</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">let</span><span class="p">(</span><span class="ss">:blog</span><span class="p">)</span> <span class="p">{</span> <span class="no">Blog</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="ss">:author</span> <span class="o">=&gt;</span> <span class="n">author</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="n">let</span><span class="p">(</span><span class="ss">:valid_json</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>        <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="n">blog</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:author</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span><span class='line'>          <span class="ss">:firstname</span> <span class="o">=&gt;</span> <span class="n">author</span><span class="o">.</span><span class="n">firstname</span><span class="p">,</span>
</span><span class='line'>          <span class="ss">:lastname</span> <span class="o">=&gt;</span> <span class="n">author</span><span class="o">.</span><span class="n">lastname</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">let</span><span class="p">(</span><span class="ss">:render</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="no">Rabl</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
</span><span class='line'>        <span class="n">blog</span><span class="p">,</span>
</span><span class='line'>        <span class="s1">&#39;blog/show&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">:view_path</span> <span class="o">=&gt;</span> <span class="s1">&#39;app/views&#39;</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">it</span> <span class="s1">&#39;should render valid_json&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">render</span><span class="o">.</span><span class="n">should</span> <span class="n">eql</span><span class="p">(</span><span class="n">valid_json</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We have a really simple test unit with a complet JSON validation. This
test is fast because no need doing some database request and no
controller stuff needed.</p>

<p>But, I found a little limitation in this method. You can&#8217;t pass some
locals variables. So you can only test this render with value pass on
the first params. If you have some other object you want use, you can&#8217;t.
I start a <a href="https://github.com/nesquena/rabl/pull/261">Pull Request</a> to
pass this variables in a <code>:locals</code> options. You can
<a href="https://github.com/nesquena/rabl/pull/261">follow it on github</a></p>

<p><a href="http://blog.shingara.fr/tester-ses-vues-rabl.html">Traduction Française</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/vundle-the-bundler-of-vim.html">Vundle the Bundler of Vim</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-31T09:48:00+02:00" pubdate data-updated="true">May 31<span>st</span>, 2012</time>
        
         | <a href="/vundle-the-bundler-of-vim.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I use vim like text editor since my school. I allways appreciate vim and
I really don&#8217;t want change to another one.</p>

<h1>How I manage my plugin around the time</h1>

<p>Vim is really powerfull with this plugins. You need really quick use it.
It&#8217;s really important to manage it. All around the time, I change how I
manage it with new technique inside vim or develop by other developper.</p>

<h2>Handmade management</h2>

<p>In start of my vim usage, I manage my plugin by copying file in
different directory. I put in versionning my <code>.vimrc</code> and <code>.vim</code>. But
this technique can be hard to maintain in time. The installation is not
really simple and know if you need update or not is hard too. So the
evolution of plugins become rare.</p>

<h2>Vimball management</h2>

<p>In vim evolution, the vimball management system was implemented. With
this vimball, you can more easily install plugin and know which version
you use. So you can improve your plugins management. But to know if a
new version is available, you need go to vimscript.org and check each of
your plugins. The update become rare too.</p>

<h2>git-submodule management</h2>

<p>With github, all plugins become a git repository. We can check all new
commit on our favorite plugin. I start to link all plugin in a new
submodule and link file in good directory. The update was really simple
and my plugins can be up to date. But the installation become really
hard.</p>

<h2>Janus management</h2>

<p>Yehuda Katz and Carl Lerche start a new project call <a href="https://github.com/carlhuda/janus">janus</a>.
This project&#8217;s goal is an easy plugin management by rake task. In this
Rakefile, you can see the list of your plugin and with some rake task
you can install it and update it. This project was really great. It
start with a bunch of plugins pre-configure and good if you start using
vim and you are not aware with what plugin can be good to you. But in
time, the management can be a little tricky with version of janus. So
it&#8217;s a really good project to start vim.</p>

<h2>Pathogen management, the first vim plugin to manage you plugins</h2>

<p>To closed of janus&#8217;s released, <a href="https://github.com/tpope">Tim Pope</a> ( a
very important vim plugin developper ) release <a href="https://github.com/tpope/vim-pathogen">Pathogen</a>.
This plugin help to manage your vim plugin directly in your <code>vimrc</code> file.
I don&#8217;t really use it. But a lot of people say it&#8217;s a really good
plugin. There are a lot of fork of janus trying to use pathogen
directly.</p>

<h2>Vundle management</h2>

<p>Now, someone told me about a very good plugin to manage his vim&#8217;s
plugin, <a href="https://github.com/gmarik/vundle">Vundle</a>. As Pathogen, the
plugin management is do directly in your <code>vimrc</code>. His usage is really
simple and well designed. If you are a ruby guy and use already <a href="http://gembundler.org">Bundler</a>,
you can easily understand how works Vundle and how use it. Vundle is
directly inspired of this project.</p>

<h1>Using Vundle</h1>

<h2>Install Vundle</h2>

<p>To install vundle, you just need clone the project&#8217;s repository in your
<code>.vim</code> directory and add 2 lignes in your <code>vimrc</code> file</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle</span></code></pre></td></tr></table></div></figure>


<p>Add in your <code>vimrc</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">set</span> <span class="nb">rtp</span><span class="p">+=~</span><span class="sr">/.vim/</span>bundle<span class="sr">/vundle/</span>
</span><span class='line'><span class="k">call</span> vundle#rc<span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Configure your plugins</h2>

<p>To use vundle after his installation, it&#8217;s really simple. You just need
add in your <code>vimrc</code> a <code>Bundle</code> command with path to your plugin. By
example, if you want install the <code>vim-rails</code> plugin, you juste need add
this line in your <code>vimrc</code> :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>Bundle <span class="s1">&#39;tpope/vim-rails.git&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Install your plugins</h2>

<p>Now, when your vim is open, you can install or update your plugins by
two vim&#8217;s command.</p>

<ul>
<li><code>BundleInstall</code> install your plugins</li>
<li><code>BundleInstall!</code> update your plugins</li>
</ul>


<p>Now, you can try this wonderfull plugin and install all plugins you want
try.</p>

<h1>My vimrc</h1>

<p>If you want see my own <code>vimrc</code> your can see it on one of my <a href="https://github.com/shingara/vim-conf">github
repository</a>. With the Vundle help,
it&#8217;s really simple to understand what plugin I really use. All is in
only one file.</p>

<p><a href="http://blog.shingara.fr/vundle-ou-le-bundler-de-vim.html">Traduction Française</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/dante-lets-you-put-some-daemon-in-your-code.html">Dante Lets You Put Some Daemon in Your Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-11T09:54:00+02:00" pubdate data-updated="true">May 11<span>th</span>, 2012</time>
        
         | <a href="/dante-lets-you-put-some-daemon-in-your-code.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Few days ago, I needed to convert a ruby script into daemon.</p>

<p>In my deployment toolkit, I use monitrc to monitor my scripts. Monit
checks a pidfile to know if the process is running or not.</p>

<p>So, I looked the best ruby solution to easily to transform this script in deamon
generating its own pidfile.</p>

<p>The most popular project in ruby to convert a ruby script into daemon is
<a href="http://daemons.rubyforge.org/">daemons</a>. I&#8217;ve tried several times in the past
and never became fan. It&#8217;s too complicated and doesn&#8217;t generate pidfile.
You have to manage everything yourself.</p>

<p>The second big project about managing daemon in the ruby community is
<a href="https://github.com/kennethkalmer/daemon-kit">daemon-kit</a>. I&#8217;ve tried it
several times without success. To me, it&#8217;s way too big and not
flexible enough to use on a simple daemon script.</p>

<p>Therefore, I decided to see if the ruby community had a new
gem for this purpose. I discovered <a href="https://github.com/bazaarlabs/dante">dante</a>.
This project was exactly what I really needed. It really gets the job done.</p>

<p>By default, Dante manages few options in commandline. These options
are all what you really need. No more useless stuff.</p>

<p>Default options available :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-p, --port PORT           Specify port
</span><span class='line'>                          (default: )
</span><span class='line'>-P, --pid FILE            save PID in FILE when using -d option.
</span><span class='line'>                          (default: /var/run/scheduler.pid)
</span><span class='line'>-d, --daemon              Daemonize mode
</span><span class='line'>-l, --log FILE            Logfile for output
</span><span class='line'>-k, --kill [PORT]         Kill specified running daemons - leave
</span><span class='line'>blank to kill all.
</span><span class='line'>-u, --user USER           User to run as
</span><span class='line'>-G, --group GROUP         Group to run as
</span><span class='line'>-?, --help                Display this usage information.</span></code></pre></td></tr></table></div></figure>


<p>You can define the PID, the log file, the user and group launching this
daemon (if launched in root). The only argument which is not essential to me is
the PORT. But this gem was created to launch rack applications. So
it&#8217;s really needed in this case.</p>

<p>An other great feature is the option extension. You can add some new
options. Dante manage to you all options pass on your script.</p>

<p>To use it, it&#8217;s really simple. You just put <code>Dante.run</code> and put your
code in a block. :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Dante</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;myapp&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">opts</span><span class="o">|</span>
</span><span class='line'>  <span class="n">myapp</span><span class="o">.</span><span class="n">run</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I am really impressed by this gem by the <a href="http://gomiso.com">gomiso</a>
company. Thanks for creating such a good gem.</p>

<p><a href="http://blog.shingara.fr/dante-pour-mettre-du-daemon-dans-son-code.html">Traduction Française</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/moped-the-new-mongodb-ruby-driver.html">Moped the New mongoDB Ruby Driver</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-07T09:38:00+02:00" pubdate data-updated="true">May 7<span>th</span>, 2012</time>
        
         | <a href="/moped-the-new-mongodb-ruby-driver.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In December 2011, <a href="https://github.com/bernerdschaefer">Bernerd Schaefer</a> created a new MongoDB ruby driver.
This new driver is not supported by 10Gen (MongoDB creator) directly.
The official MongoDB ruby driver is the gem <a href="https://github.com/mongodb/mongo-ruby-driver">mongo-ruby-driver</a>.</p>

<h1>Goal of this gem</h1>

<p>This gem will be created after some frustration from the Mongoid Core
developer
The team proposed to change the internal software design on MongoDB Ruby driver but all changes were refused.</p>

<h2>Thread-safe</h2>

<p>One of this gem&#8217;s goals was to have a more thread-safe gem than the official MongoDB ruby driver.
This official gem is sometimes considered like not 100% thread-safe like reported <a href="https://github.com/mperham/sidekiq/wiki/Problems-and-Troubleshooting">Mike Perham</a>.
Since the ruby community discovered again the thread, it hasn&#8217;t stopped of being a real problem.
With Moped we can use <a href="http://mperham.github.com/sidekiq/">sidekiq</a>.</p>

<h2>No more extension</h2>

<p>If you want to use the MongoDB official driver, you will need to install another
gem <a href="http://rubygems.org/gems/bson_ext">bson_ext</a>.
Without it, you will have some performance penalties.
As this gem is a C extension, this gem has 2 versions in order to be compatible with JRuby.
One in C and the other in Java. It&#8217;s therefore harder to maintain.</p>

<p>With Moped, no more extension needed.
Everything is done in pure ruby.
A benchmark shows that this moped&#8217;s bson version is even faster than the C extension.</p>

<p>The only case where moped is slower than bson_ext is the ObjectId generation, like reported on <a href="https://groups.google.com/d/topic/mongoid/87IdIKO8-VM/discussion">Mongoid mailing-list</a>.
But, after all, Moped is new.
It can be improved in the future.</p>

<h2>Cleanest API</h2>

<p>The Moped API is really clean and simple.
It depends on the developers using it.
But, to me, it&#8217;s a good API because it&#8217;s really more &#8220;ruby way&#8221;.</p>

<h2>Better Replicat Set management</h2>

<p>One of big feature of MongoDB is the ReplicatSet.
With Moped, the ReplicatSet management is even better.
There are no exception raise when a node is down.
The switch off of node is immediately done by Moped.</p>

<p>No need to list all of your node.
Moped does it automaticly with the MongoDB mechanism.
You can even add new nodes in your Replicat without restarting your application.</p>

<h1>Limitation</h1>

<p>Moped has some limitation in front of Mongo-ruby-driver.</p>

<h2>Ruby 1.9 only</h2>

<p>Moped works only with Ruby > 1.9. in order to avoid troubles with the 1.8 compatibilities.
For instance, the Socket on Ruby 1.8 series is not the best.</p>

<h2>No GridFS support</h2>

<p>GridFS is not supported on Moped.
This choice has been made to limit the size of the Moped code core.
In the future, this feature may be added in a Moped extension.</p>

<h1>Mongoid 3 integration</h1>

<p>Mongoid 3 now uses only MongoDB ruby driver.
Moped is a new dependency of Mongoid and mongo-ruby-driver is not anymore a dependencie.
If you want to try this new driver you can test it on Mongoid 3.</p>

<p>Warning: Mongoid 3 is still not released.
If you want to test it, you will need to use the Master branch on Mongoid.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">gem</span> <span class="s1">&#39;mongoid&#39;</span><span class="p">,</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s1">&#39;git://github.com/mongoid/mongoid&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://blog.shingara.fr/moped-le-nouveau-driver-mongodb-pour-ruby.html">French Translation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/quiet-assets-help-you-to-have-little-log.html">Quiet Assets Help You to Have Little Log</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-26T09:39:00+02:00" pubdate data-updated="true">Apr 26<span>th</span>, 2012</time>
        
         | <a href="/quiet-assets-help-you-to-have-little-log.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One week ago, I discover a new gem really helpfull, <a href="https://github.com/evrone/quiet_assets">quiet_assets</a>.</p>

<p>This gem is not a big deal, but it help a lot when you develop a Rails
application ( > 3.1 ) with &#8216;assets_pipeline&#8217;. If you have a lot of
assets you have already see in your log a lot of information about
requests doing on this assets. You can see log like :</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Started GET "/assets/application.js?body=1" for 127.0.0.1 at 2012-02-13 13:24:04 +0400
</span><span class='line'>Served asset /application.js - 304 Not Modified (8ms)</span></code></pre></td></tr></table></div></figure>


<p>After, when you want see the log really interresting about the request
you do, you need up on your log. It&#8217;s really annoying. Our log file is
really bloat by this logs.</p>

<p>But <a href="https://github.com/evrone/quiet_assets">quiet_assets</a> is here to
help you in this mess. After adding this gem in your Gemfile.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'quiet_assets', :group =&gt; :development</span></code></pre></td></tr></table></div></figure>


<p>You can discover your log clean and light like before assets_pipeline. No more logs about your assets
request. Just your log you really need.</p>

<p>Some gem can really be usefull even if it&#8217;s little.</p>

<p>Since rails 3.2.0, there are an option to define the logger of
Sprockets. All informations is on this <a href="https://github.com/rails/rails/issues/2639">issue 2639</a>.
But quiet_assets is allways usefull. When you define your sprocket&#8217;s log to
false you have allways logs from actionpack. You have less log, but
allways too much.</p>

<p><a href="http://blog.shingara.fr/quiet-assets-le-limiteur-de-log.html">French Translation</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/one-day-dedicated-to-mongodb.html">One Day Dedicated to MongoDB</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-05-19T00:00:00+02:00" pubdate data-updated="true">May 19<span>th</span>, 2010</time>
        
         | <a href="/one-day-dedicated-to-mongodb.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://blog.shingara.fr/files/badge-mongofr-large.png" alt="mongoFR badges"/></p>

<p>On June 21st 2010 I highly recommend you to attend <a href="http://www.10gen.com/conferences/event_mongofr_21june10">&#8220;the MongoFR&#8221;</a>, an event devoted to <a href="http://mongodb.com">MongoDB</a>.</p>

<p>I am lucky to participate in this event. I will speak about my experiences on
migration from SQL to MongoDB based on what I&#8217;ve learned working on the <a href="http://oupsnow.rubyforge.org">Oupsnow</a> project.</p>

<p>In my opinion, this new technology is both really interesting and promising.</p>

<p>If you want to discover MongoDB, come by on <a href="http://www.10gen.com/conferences/event_mongofr_21june10">June 21st</a>.</p>

<p><a href="http://blog.shingara.fr/une-journee-dediee-i-mongodb.html">Traduction française</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/eventmachines-periodictimer-the-simply-cron.html">EventMachine&#8217;s PeriodicTimer the Simply Cron</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-04-02T00:00:00+02:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2010</time>
        
         | <a href="/eventmachines-periodictimer-the-simply-cron.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://rubyeventmachine.com/">EventMachine</a> is one of the best Ruby libraries. But it&#8217;s also the most unknown and unused.</p>

<p>I started to look at Event Machine and where I could use it. The first application I found was the <a href="http://eventmachine.rubyforge.org/EventMachine/PeriodicTimer.html">PeriodicTimer</a>.</p>

<p>This feature aims to replace the cronjob.</p>

<p>Let me explain : a cronjob is really a great tool. We can precisely define the time where task is executed. Usually, this task executes precisely at a given time… But when a task is executed too soon, using a cronjob can become awful.</p>

<p>Cron doesn&#8217;t have any queue system, therefore there can be an increase of the number of tasks running at same time. Your server might become overloaded and in that case you&#8217;d have to restart it. This situation would happen only if your task is created to be executed more times than your frequency of execution.</p>

<p>The solution can be to have a little application like <a href="http://forge.bearstech.com/trac/wiki/JobQueue">jobq</a> to manage your queue system. But in many cases you don&#8217;t really need a queue system, so it would be a little bit like overkill.</p>

<p>The PeriodicTime&#8217;s advantage is to execute after a time define precisely. There is no management of time: only the elapse time needs to be managed. The task is sent after X seconds after the end of the previous task and when there are no tasks running anymore. There might be some little variations in the time the task will execute, but it&#8217;s not really a problem. The most important is that the task is executed regularly (e.g. when fetching statistics).</p>

<p>Below is [a sample of code]http://gist.github.com/345000)  using PeriodicTimer.</p>

<p>&lt;typo:code lang=&#8221;ruby&#8221;>
require &#8216;eventmachine&#8217;
require &#8216;timeout&#8217;
EventMachine.run {
 EventMachine::PeriodicTimer.new(10) do
   puts &#8220;#{Time.now} : I am 10&#8221;
   sleep 10
 end</p>

<p> EventMachine::PeriodicTimer.new(1) do
   puts Time.now
 end
}
&lt;/typo:code></p>

<p>And the output is after 50 second of execution.</p>

<p>&lt;typo:code lang=&#8221;plain&#8221;>
$ ruby em_periodic.rb
Fri Mar 26 16:07:39 +0100 2010
Fri Mar 26 16:07:40 +0100 2010
Fri Mar 26 16:07:41 +0100 2010
Fri Mar 26 16:07:42 +0100 2010
Fri Mar 26 16:07:43 +0100 2010
Fri Mar 26 16:07:44 +0100 2010
Fri Mar 26 16:07:45 +0100 2010
Fri Mar 26 16:07:46 +0100 2010
Fri Mar 26 16:07:47 +0100 2010
Fri Mar 26 16:07:48 +0100 2010 : I am 10
Fri Mar 26 16:07:58 +0100 2010
Fri Mar 26 16:07:59 +0100 2010
Fri Mar 26 16:08:00 +0100 2010
Fri Mar 26 16:08:01 +0100 2010
Fri Mar 26 16:08:02 +0100 2010
Fri Mar 26 16:08:03 +0100 2010
Fri Mar 26 16:08:04 +0100 2010
Fri Mar 26 16:08:05 +0100 2010
Fri Mar 26 16:08:06 +0100 2010
Fri Mar 26 16:08:08 +0100 2010
Fri Mar 26 16:08:08 +0100 2010 : I am 10
Fri Mar 26 16:08:18 +0100 2010
Fri Mar 26 16:08:19 +0100 2010
Fri Mar 26 16:08:20 +0100 2010
Fri Mar 26 16:08:21 +0100 2010
Fri Mar 26 16:08:22 +0100 2010
Fri Mar 26 16:08:23 +0100 2010
Fri Mar 26 16:08:25 +0100 2010
Fri Mar 26 16:08:26 +0100 2010
Fri Mar 26 16:08:27 +0100 2010
Fri Mar 26 16:08:28 +0100 2010
Fri Mar 26 16:08:28 +0100 2010 : I am 10
&lt;/typo:code></p>

<p>We can see that the task is executed each second. But the other task executing after 10 seconds, runs and locks the thread. So the first task (executing each second) is executed only after the end of second one. After that, each second the task restarts. and locks again after 10 seconds.</p>

<p>This is really the great strength of PeriodicTimer. We can easily make a suite of tasks who will never execute at the same time. Lately I&#8217;m using this for all my scripts fetching data.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/.html">About</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-29T00:00:00+02:00" pubdate data-updated="true">Mar 29<span>th</span>, 2010</time>
        
         | <a href="/.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Who Am I?</h1>

<p>This is the Cyril Mougel&#8217;s blog. I spoke about my developments experiences. That can be some bugs, or new stuff.</p>

<h1>What about I speak ?</h1>

<p>The blog&#8217;s main line is mainly the framework <a href="http://rubyonrails.org">Ruby on Rails</a>, but also all around the <a href="http://ruby-lang.org">Ruby lang</a>.</p>

<p>Voici le blog de Cyril Mougel. Ici, j&#8217;y parle de mes expériences de développement. Que ca soit des bugs, rencontrés des nouveautés ou des améliorations apportés.</p>

<h1>My experience</h1>

<p>After 1 year in CapGemini where I code on J2EE, I am now a Ruby on Rails developer since 2008 in several companies.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/oupsnow-0-5-0-released.html">Oupsnow 0.5.0 Released</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-03-13T00:00:00+01:00" pubdate data-updated="true">Mar 13<span>th</span>, 2010</time>
        
         | <a href="/oupsnow-0-5-0-released.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">  <p>That&#8217;s it. After only one month to released <a href="http://oupsnow.rubyforge.org/">Oupsnow</a> 0.4.1, I released the 0.5.0 version. This version
  mark adding features and stability on code base.</p>

  <p>New features ?</p>

  <ul>
  <li> Add filter by closed or not with closed keywords</li>
  <li>You can edit a milestone now</li>
  <li>You can define one milestone like current. By define the first one created</li>
  <li>Add the recover password configuration by your email</li>                                                                                                
  <li>Add remember solution when you logged</li>
  <li>Add information about number of ticket in search</li>
  <li>A logged user can watch a ticket. If user watch ticket he received email
  when ticket is update</li>
  <li>A user can change his own email.</li>
  </ul>

  <p>Like I made each time, my capistrano file to deploy Oupsnow</p>
  <typo:code lang="ruby">
  set :application, &#8220;oupsnow&#8221;
  set :repository,  &#8220;git://github.com/shingara/oupsnow.git&#8221;
  set :domain, &#8220;dev.shingara.fr&#8221;

  # If you aren&#8217;t deploying to /u/apps/#{application} on the target
  # servers (which is the default), you can specify the actual location
  # via the :deploy_to variable:
  set :deploy_to, &#8220;XXXXXXXXX&#8221;

  # If you aren&#8217;t using Subversion to manage your source code, specify
  # your SCM below:
  # set :scm, :subversion
  set :scm, :git
  set :git_enable_submodules, 1

  set :runner, &#8220;xxxx&#8221;
  set :user, &#8220;xxxx&#8221;
  set :use_sudo, false

  set :thin_conf, &#8220;/etc/thin/#{domain}.yml&#8221;

  set :rails_env, &#8220;production&#8221;

  role :app, domain
  role :web, domain
  role :db,  domain, :primary => true

  task :update_config, :roles => [:app] do
    run &#8220;ln -s #{shared_path}/config/database.yml #{release_path}/config/database.yml&#8221;
    run &#8220;ln -s #{shared_path}/config/email.yml #{release_path}/config/email.yml&#8221;
    run &#8220;ln -s #{shared_path}/config/initializers/errornot.rb #{release_path}/config/initializers/errornot.rb&#8221;
    run &#8220;cd #{release_path} && echo &#8216;GOOGLE_ANALYTICS=&#34;XXXXXXXX&#34;&#8217; >> config/environment.rb&#8221;
  end

  namespace :deploy do
    task :start, :roles => [:app] do
      run &#8220;thin -C #{thin_conf} start&#8221;
    end

    task :stop, :roles => [:app] do
      run &#8220;thin -C #{thin_conf} stop&#8221;
    end

    task :restart, :roles => [:app] do
      run &#8220;thin -C #{thin_conf} restart&#8221;
    end
  end

  task :update_db do
    run &#8220;cd #{current_path} && RAILS_ENV=#{rails_env} rake db:update&#8221;
  end

  after &#8220;deploy:update_code&#8221;, :update_config
  after &#8220;deploy:symlink&#8221;, :update_db
  </typo:code>

  <p><a href="http://blog.shingara.fr/oupsnow-0-5-0-est-sortie.html">Traduction française</a></p> 
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/typo-5-4-0-released.html">Typo 5.4.0 Released</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-29T00:00:00+01:00" pubdate data-updated="true">Dec 29<span>th</span>, 2009</time>
        
         | <a href="/typo-5-4-0-released.html#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>That&#8217;s it. A new version of <a href="http://typosphere.org">Typo</a> is released. I don&#8217;t really participate to this
  version, by lack of time and motivation, but I am allways proud to see a new version.</p>
  <p>Each release see a new admin, but each time is allways better than previous. So it&#8217;s a good thing.
  <p>My french blog is update and use this new version with new default design.</p>
  <p>My little gift with this released is my capistrano config file to deploy it. It can be useful</p>

  <typo:code>
  set :application, &#8220;typo&#8221;
  set :repository,  &#8220;git://github.com/fdv/typo.git&#8221;
  set :domain, &#8220;blog.shingara.fr&#8221;

  # If you aren&#8217;t deploying to /u/apps/#{application} on the target
  # # servers (which is the default), you can specify the actual location
  # # via the :deploy_to variable:
  set :deploy_to, &#8220;/var/rails/blog-typo&#8221;
  #
  # # If you aren&#8217;t using Subversion to manage your source code, specify
  # # your SCM below:
  set :scm, :git

  set :runner, &#8220;rails&#8221;
  set :user, &#8220;rails&#8221;
  set :use_sudo, false

  set :thin_conf, &#8220;/etc/thin/#{domain}.yml&#8221;

  role :app, domain
  role :web, domain
  role :db,  domain, :primary => true

  task :update_config, :roles => [:app] do
    run &#8220;cp -Rf #{shared_path}/config/* #{release_path}/config/&#8221;
    run &#8220;ln -s #{shared_path}/files #{release_path}/public/files&#8221;
  end

  task :update_gems, :roles => [:app] do
    run &#8220;cd #{release_path} && RAILS_ENV=production rake gems:install&#8221;
  end


  after &#8220;deploy:update_code&#8221;, :update_config
  after &#8220;deploy:update_code&#8221;, :update_gems


  namespace :deploy do
    task :start, :roles => [:app] do
      run &#8220;thin -C #{thin_conf} start&#8221;
    end

    task :stop, :roles => [:app] do
      run &#8220;thin -C #{thin_conf} stop&#8221;
    end

    task :restart, :roles => [:app] do
      run &#8220;thin -C #{thin_conf} restart&#8221;
    end
  end

  task :clear_cache, :roles => [:app] do                                                                                                                       
    run &#8220;cd #{current_path} && RAILS_ENV=production rake sweep_cache&#8221;
    run &#8220;cd #{current_path} && RAILS_ENV=production rake tmp:cache:clear&#8221;
  end

  after &#8220;deploy:restart&#8221;, :clear_cache
  after &#8220;deploy:start&#8221;, :clear_cache
  </typo:code>

  <p><a href="http://blog.shingara.fr/sortie-de-typo-5-4-0.html">Traduction française</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/test-your-rabl-view.html">Test your Rabl&#8217;s view</a>
      </li>
    
      <li class="post">
        <a href="/vundle-the-bundler-of-vim.html">vundle the bundler of vim</a>
      </li>
    
      <li class="post">
        <a href="/dante-lets-you-put-some-daemon-in-your-code.html">Dante lets you put some daemon in your code</a>
      </li>
    
      <li class="post">
        <a href="/moped-the-new-mongodb-ruby-driver.html">Moped the new mongoDB ruby driver</a>
      </li>
    
      <li class="post">
        <a href="/quiet-assets-help-you-to-have-little-log.html">Quiet assets help you to have little log</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/shingara">@shingara</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'shingara',
            count: 10,
            skip_forks: false,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("shingara", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/shingara" class="twitter-follow-button" data-show-count="true">Follow @shingara</a>
  
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Cyril Mougel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'blog-en-shingara';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
